  :root {
    /* ── Base palette (dark theme) ── */
    --bg-primary: #16161e;
    --bg-secondary: #1a1a2e;
    --bg-tertiary: #1e1e2e;
    --bg-input: #12121f;
    --border: #2a2a3a;
    --text-primary: #e0e0e0;
    --text-secondary: #9a9a9a;
    --text-muted: #808080;
    --accent-blue: #60a5fa;
    --accent-purple: #b0b8ff;
    --accent-yellow: #f59e0b;
    --accent-green: #34d399;
    --accent-violet: #c084fc;

    /* ── Step 1+2: Style unification ── */

    /* Text */
    --text-highlight: #78f0c0;      /* filename display, modal item name */
    --text-dim: #888;               /* github link, col headers, subtle labels */
    --text-faint: #555;             /* drag handle, delete btn normal */
    --text-subtle: #aaa;            /* drag handle hover, mapping text, code inline */
    --text-disabled: #666;          /* disabled ctx items, disconnected dot */
    --text-amber-hint: #886;        /* paddle hint text */
    /* consolidated: --text-mid(#999)->--text-secondary, --text-light(#bbb)->--text-subtle,
       --text-ctx(#ddd)->--text-primary, --text-placeholder(#777)->--text-muted */

    /* Borders */
    --border-ui: #333;              /* UI parts: toolbar sep, input borders */
    --border-ui-strong: #444;       /* Stronger UI: modal frames, selects */
    --border-raised: #3a3a4a;       /* Theme-tinted: type-select, kb-tabs, badges */
    --border-key: #666;             /* key badge border */
    --border-focus: #5a5aff;        /* focus ring, name-input focus */

    /* Backgrounds */
    --bg-ctx-menu: #252536;         /* context menu, type-select option */
    /* consolidated: --bg-overlay(#1a1a28)->--bg-secondary */
    --bg-paddle-hint: #1a1a10;      /* paddle hint area */
    --bg-btn: #2a2a3a;              /* gamepad/keyboard buttons */
    --bg-btn-hover: #3a3a5a;        /* gamepad/keyboard button hover */
    --bg-key-hover: #4a4a6a;        /* kb-key hover */
    --bg-key-active: #5a5a8a;       /* kb-key active */

    /* Interactive borders */
    --btn-hover-border: #6a6aff;    /* gamepad btn hover border */
    --key-hover-border: #7a7aff;    /* kb-key hover border */

    /* Shadows */
    --shadow-key: #222;             /* key badge / kb-key drop shadow */

    /* Tree connectors */
    --tree-connector: #8888bb;

    /* Danger / delete */
    --danger-text: #f87171;
    --danger-bg: rgba(248,113,113,0.12);

    /* Row states */
    --row-hover-bg: rgba(255,255,255,0.07);
    --row-divider: rgba(255,255,255,0.09);
    --row-selected-bg: rgba(96,165,250,0.28);
    --row-drop-bg: rgba(96,165,250,0.35);
    --row-category-bg: rgba(245,158,11,0.06);  /* category row tint */
    --row-category-hover-bg: rgba(245,158,11,0.12); /* category row hover */
    --row-excluded-bg: rgba(251,191,36,0.08);   /* ③ excluded row tint */

    /* Meta block */
    --meta-bg:          rgba(100,200,255,0.05);
    --meta-hover-bg:    rgba(100,200,255,0.10);
    --meta-border:      rgba(100,200,255,0.30);
    --modal-btn-save-meta: #0369a1;

    /* Accent / action buttons */
    --btn-accent: #2563eb;
    --btn-accent-hover: #1d4ed8;
    --btn-accent-text: #fff;
    --btn-accent2: #7c3aed;
    --btn-accent2-hover: #6d28d9;

    /* Modal action buttons */
    --modal-btn-cancel: #5a5a6a;
    --modal-btn-neutral: #6b7280;
    --modal-btn-skip: #4b5563;
    --modal-btn-apply-next: #16a34a;
    --modal-btn-text: #fff;

    /* Status */
    --status-connected: #22c55e;

    /* Decorative */
    --deco-sep-color: #666;

    /* Overlay */
    --bg-overlay: rgba(0,0,0,0.6);

    /* Misc interactive */
    --collapse-hover-bg: rgba(255,255,255,0.08);
    --btn-badge-border: rgba(255,255,255,0.15);
    --kbd-hint-bg: rgba(255,255,255,0.12);
    --kbd-hint-border: rgba(255,255,255,0.2);
  }
  * { margin: 0; padding: 0; box-sizing: border-box; }
  body {
    font-family: 'Segoe UI', 'メイリオ', sans-serif;
    background: var(--bg-primary); color: var(--text-primary);
    font-size: 13px; line-height: 1.4;
  }
  button { font-family: inherit; }

  /* ── Header ── */
  #header {
    background: var(--bg-secondary); border-bottom: 1px solid var(--border);
    padding: 8px 12px; display: flex; align-items: center; gap: 8px;
    position: sticky; top: 0; z-index: 100; flex-wrap: wrap;
  }
  #header .app-title { font-size: 15px; font-weight: 700; color: var(--accent-purple); margin-right: 4px; }
  #header .github-link {
    color: var(--text-dim); display: flex; align-items: center;
    text-decoration: none; padding: 2px 4px; border-radius: 4px;
    transition: color 0.15s, background 0.15s;
  }
  #header .github-link:hover { color: var(--text-primary); background: var(--row-hover-bg); }
  #header .filename {
    background: var(--bg-input); border: 1px solid var(--border-ui); border-radius: 4px;
    padding: 4px 10px; font-size: 12px; color: var(--text-highlight); font-weight: 600;
  }
  #header .filename[id="filenameDisplay"]:hover {
    border-color: var(--border-focus); cursor: pointer;
  }
  #header .filename[id="filenameDisplay"]::after {
    content: " ✏️"; font-size: 10px; opacity: 0; transition: opacity 0.15s;
  }
  #header .filename[id="filenameDisplay"]:hover::after { opacity: 1; }

  /* filenameEdit: display:none is controlled by JS, other styles here */
  #filenameEdit {
    cursor: text;
    outline: 1px solid var(--border-focus);
    width: 220px;
  }

  /* Header selects */
  #sampleSelect {
    background: var(--bg-tertiary);
    color: var(--text-secondary);
    border: 1px solid var(--border-ui);
    border-radius: 6px;
    padding: 5px 8px;
    font-size: 12px;
    cursor: pointer;
    max-width: 180px;
  }
  #controllerSelect {
    background: var(--bg-tertiary);
    color: var(--text-primary);
    border: 1px solid var(--border-ui-strong);
    border-radius: 6px;
    padding: 5px 8px;
    font-size: 12px;
    font-weight: 600;
    cursor: pointer;
  }
  #langBtn {
    font-size: 13px;
  }

  .toolbar-spacer { flex: 1; }
  .toolbar-sep { width: 1px; height: 20px; background: var(--border-ui); }
  .toolbar-btn {
    background: transparent; color: var(--text-primary); border: 1px solid var(--border-ui);
    border-radius: 6px; padding: 5px 12px; font-size: 12px; font-weight: 600;
    cursor: pointer; display: flex; align-items: center; gap: 4px; white-space: nowrap;
  }
  .toolbar-btn:hover { background: var(--bg-btn); }
  .toolbar-btn:disabled { opacity: 0.4; cursor: default; }
  .toolbar-btn.accent { background: var(--btn-accent); border: none; color: var(--btn-accent-text); }
  .toolbar-btn.accent:hover { background: var(--btn-accent-hover); }
  a.toolbar-btn { text-decoration: none; }
  a.toolbar-btn:visited { color: var(--text-primary); }
  a.toolbar-btn.accent:visited { color: var(--btn-accent-text); }
  .toolbar-btn.accent2 { background: var(--btn-accent2); border: none; color: var(--btn-accent-text); }
  .toolbar-btn.accent2:hover { background: var(--btn-accent2-hover); }

  /* ── Column Headers ── */
  #col-headers {
    display: flex; align-items: center; padding: 4px 8px;
    background: var(--bg-secondary); border-bottom: 1px solid var(--border);
    font-size: 10px; color: var(--text-dim); font-weight: 600; text-transform: uppercase;
    letter-spacing: 0.5px; position: sticky; top: 44px; z-index: 99;
  }
  #col-headers .col-type { width: 80px; flex-shrink: 0; margin-right: 6px; padding-left: 8px; }
  #col-headers .col-name { flex: 1; }
  #col-headers .col-mapping { width: 280px; flex-shrink: 0; }
  #col-headers .col-output { width: 32px; flex-shrink: 0; text-align: center; }

  /* ── Item Rows ── */
  #item-list { padding: 2px 0; padding-bottom: 88px; }
  .item-row {
    display: flex; align-items: center; padding: 3px 8px;
    border-left: 2px solid transparent; border-bottom: 1px solid var(--row-divider);
    transition: background 0.1s; cursor: default;
    position: relative; /* ② ドラッグハンドル絶対配置のため */
  }
  .item-row:hover { background: var(--row-hover-bg); }
  .item-row.is-category { background: var(--row-category-bg); }
  .item-row.is-category:hover { background: var(--row-category-hover-bg); }

  /* ③ 除外行スタイル */
  .item-row.is-excluded:not(.is-meta),
  .item-row.is-excluded:not(.is-meta):hover {
    background: var(--row-excluded-bg);
  }
  .item-row.is-inherited-exclude:not(.is-meta),
  .item-row.is-inherited-exclude:not(.is-meta):hover {
    background: var(--row-excluded-bg);
  }
  .item-row.is-excluded:not(.is-meta) > .col-name,
  .item-row.is-excluded:not(.is-meta) > .col-mapping,
  .item-row.is-excluded:not(.is-meta) > .col-type {
    opacity: 0.65;
  }
  .item-row.is-inherited-exclude:not(.is-meta) > .col-name,
  .item-row.is-inherited-exclude:not(.is-meta) > .col-mapping,
  .item-row.is-inherited-exclude:not(.is-meta) > .col-type {
    opacity: 0.45;
  }

  /* 選択状態は除外状態より優先（同一specificity → ソース順で後勝ち、複合クラスは明示指定） */
  .item-row.selected,
  .item-row.is-excluded.selected,
  .item-row.is-inherited-exclude.selected {
    background: var(--row-selected-bg);
    border-left-color: var(--accent-blue);
  }

  /* ─── Meta block rows ─────────────────────────────────────────────── */
  .item-row.is-meta {
    background: var(--meta-bg);
    border-left: 2px solid var(--meta-border);
  }
  .item-row.is-meta:hover {
    background: var(--meta-hover-bg);
  }
  .item-row.is-meta.selected {
    background: var(--row-selected-bg);
    border-left-color: var(--accent-blue);
  }

  /* SYS制限アイテムのドラッグハンドル無効化 */
  .drag-handle-disabled {
    position: absolute; left: 2px; top: 50%; transform: translateY(-50%);
    width: 18px; color: var(--text-faint);
    font-size: 14px; text-align: center; user-select: none;
    line-height: 18px; border-radius: 3px; flex-shrink: 0;
    opacity: 0.3; cursor: default;
  }

  /* SYS制限アイテムの読み取り専用マッピング表示 */
  .mapping-box.meta-readonly {
    display: flex; align-items: center; gap: 5px;
    font-family: var(--font-mono, monospace); font-size: 12px;
    color: var(--text-subtle); padding: 2px 6px;
    border: 1px solid var(--border); border-radius: 4px;
    background: var(--bg-raised); min-height: 26px;
    flex: 1; cursor: default;
  }

  /* 色アイテムの編集可能マッピング表示 */
  .mapping-box.meta-color-edit {
    display: flex; align-items: center; gap: 5px;
    font-family: var(--font-mono, monospace); font-size: 12px;
    color: var(--text-primary); padding: 2px 6px;
    border: 1px solid var(--border-ui); border-radius: 4px;
    background: var(--bg-input); min-height: 26px;
    flex: 1; cursor: text;
    transition: border-color 0.15s;
  }
  .mapping-box.meta-color-edit:hover {
    border-color: var(--accent-blue);
  }
  .mapping-box.meta-color-edit .mapping-text.empty {
    opacity: 0.4; font-style: italic;
  }

  /* カラースウォッチ */
  .color-swatch {
    display: inline-block; width: 14px; height: 14px;
    border-radius: 3px; border: 1px solid var(--border);
    flex-shrink: 0; vertical-align: middle;
  }
  .color-swatch-invalid {
    background: repeating-linear-gradient(
      45deg, var(--bg-raised) 0px, var(--bg-raised) 4px,
      var(--danger-text) 4px, var(--danger-text) 6px
    );
    font-size: 9px; color: var(--danger-text);
    display: inline-flex; align-items: center; justify-content: center;
    font-weight: bold;
  }

  /* ② ドラッグハンドル: 絶対左端固定 */
  .drag-handle {
    position: absolute; left: 2px; top: 50%; transform: translateY(-50%);
    width: 18px; cursor: grab; color: var(--text-faint);
    font-size: 14px; text-align: center; user-select: none;
    line-height: 18px; border-radius: 3px; flex-shrink: 0;
    transition: color 0.15s, background 0.15s;
  }
  .drag-handle:hover { color: var(--text-subtle); background: var(--row-hover-bg); }
  .drag-handle:active { cursor: grabbing; }

  /* ① 削除ボタン: 常時表示 (opacity:0 廃止) */
  .row-delete-btn {
    width: 22px; height: 22px; flex-shrink: 0; margin-left: 4px;
    background: transparent; border: none; border-radius: 4px;
    color: var(--text-muted); font-size: 15px; line-height: 20px; cursor: pointer;
    display: flex; align-items: center; justify-content: center;
    transition: color 0.15s, background 0.15s;
  }
  .row-delete-btn:hover { color: var(--danger-text); background: var(--danger-bg); }

  .item-row.drop-child {
    background: var(--row-drop-bg) !important;
    outline: 1px dashed var(--accent-blue);
    outline-offset: -1px;
  }
  .item-row .col-type { width: 80px; flex-shrink: 0; margin-right: 6px; }
  .item-row .col-name { flex: 1; min-width: 0; margin-right: 8px; display: flex; align-items: center; }
  .item-row .col-mapping { width: 280px; flex-shrink: 0; display: flex; align-items: center; gap: 4px; }
  .item-row .col-output { width: 32px; flex-shrink: 0; display: flex; align-items: center; justify-content: center; }

  /* ③ 出力チェックボックス (output-toggle ボタン → カスタムチェックボックス) */
  .output-checkbox {
    appearance: none;
    -webkit-appearance: none;
    width: 16px; height: 16px; flex-shrink: 0;
    border: 1.5px solid var(--text-faint);
    border-radius: 3px;
    background: transparent;
    cursor: pointer;
    position: relative;
    transition: border-color 0.15s, background 0.15s;
    vertical-align: middle;
  }
  .output-checkbox:checked {
    background: var(--accent-green);
    border-color: var(--accent-green);
  }
  .output-checkbox:checked::after {
    content: '';
    position: absolute;
    left: 3px; top: 1px;
    width: 4px; height: 8px;
    border: 2px solid #fff;
    border-top: none;
    border-left: none;
    transform: rotate(45deg);
  }
  .output-checkbox:disabled {
    opacity: 0.35;
    cursor: default;
  }
  .output-checkbox:not(:disabled):hover {
    border-color: var(--text-subtle);
  }
  .output-checkbox:focus-visible {
    outline: 2px solid var(--border-focus);
    outline-offset: 2px;
  }

  .type-select {
    background: transparent; color: var(--accent-blue); border: 1px solid var(--border-raised);
    border-radius: 4px; padding: 2px 4px; font-size: 11px; font-weight: 600;
    cursor: pointer; outline: none; width: 100%;
  }
  .type-select option { background: var(--bg-ctx-menu); }

  .name-input {
    background: transparent; color: var(--text-primary); border: none; outline: none;
    flex: 1; min-width: 0; font-size: 12px; padding: 2px 4px;
    border-bottom: 1px solid transparent;
  }
  .name-input:focus { border-bottom: 1px solid var(--border-focus); }
  .name-input.is-category { color: var(--accent-yellow); font-size: 13px; font-weight: 700; }

  .collapse-toggle {
    display: inline-flex; align-items: center; justify-content: center;
    width: 16px; flex-shrink: 0; text-align: center; cursor: pointer;
    color: var(--text-secondary); font-size: 10px; margin-right: 2px; user-select: none;
    border-radius: 3px; line-height: 18px; vertical-align: middle;
    transition: color 0.15s;
  }
  .collapse-toggle:hover { color: var(--text-primary); background: var(--collapse-hover-bg); }

  /* Tree connectors */
  .tree-guide {
    display: inline-flex; flex-shrink: 0; width: 20px;
    position: relative; align-self: stretch;
  }
  .tree-guide-line {
    position: absolute; left: 9px; top: 0; bottom: 0;
    border-left: 1px solid var(--tree-connector);
  }
  .tree-guide-branch {
    position: absolute; left: 9px; top: 0; height: 50%;
    border-left: 1px solid var(--tree-connector);
    border-bottom: 1px solid var(--tree-connector);
    width: 8px; border-bottom-left-radius: 4px;
  }
  .tree-guide-last .tree-guide-branch {
    height: 50%;
  }

  /* (parent-select removed — use drag-and-drop for re-parenting) */

  /* Mapping display */
  .mapping-box {
    flex: 1; background: var(--bg-input); border-radius: 4px; border: 1px solid var(--border);
    min-height: 28px; display: flex; align-items: center; padding: 2px 4px;
    cursor: text; min-width: 0; overflow: hidden;
  }
  .mapping-box.empty { color: var(--text-muted); font-size: 11px; font-style: italic; }
  .mapping-edit-input {
    background: var(--bg-input); color: var(--text-primary); border: 1px solid var(--border-focus);
    border-radius: 4px; padding: 2px 6px; font-size: 12px; font-family: monospace;
    width: 100%; outline: none;
  }
  .gamepad-btn {
    background: var(--bg-btn); border: 1px solid var(--border-raised); border-radius: 4px;
    width: 28px; height: 28px; display: flex; align-items: center; justify-content: center;
    cursor: pointer; flex-shrink: 0; font-size: 14px; padding: 0; color: var(--text-subtle);
    transition: background 0.15s, border-color 0.15s;
  }
  .gamepad-btn:hover { background: var(--bg-btn-hover); border-color: var(--btn-hover-border); }

  /* Button badges */
  .btn-badge {
    display: inline-flex; align-items: center; justify-content: center;
    padding: 1px 5px; border-radius: 4px; font-size: 11px; font-weight: 700;
    margin-right: 1px; min-width: 20px; line-height: 18px; font-family: monospace;
    box-shadow: 0 1px 2px rgba(0,0,0,0.3); border: 1px solid var(--btn-badge-border);
  }
  .btn-plus { color: var(--text-dim); margin: 0 2px; font-size: 10px; }
  .key-badge {
    display: inline-flex; align-items: center; justify-content: center;
    padding: 1px 5px; border-radius: 3px; font-size: 10px; font-weight: 700;
    margin-right: 1px; min-width: 20px; line-height: 18px; font-family: monospace;
    background: var(--border-raised); color: var(--text-primary); border: 1px solid var(--border-key);
    box-shadow: 0 2px 0 var(--shadow-key), 0 1px 2px rgba(0,0,0,0.3);
  }
  .mapping-text {
    color: var(--text-subtle); font-size: 11px; line-height: 18px; margin: 0 1px; white-space: pre;
  }

  /* Keyboard modal tabs */
  .kb-tabs {
    display: flex; gap: 2px; margin-bottom: 8px;
    border-bottom: 1px solid var(--border-raised);
  }
  .kb-tab {
    background: transparent; border: none; border-bottom: 2px solid transparent;
    color: var(--text-secondary); font-size: 12px; font-weight: 600;
    padding: 4px 14px; cursor: pointer; margin-bottom: -1px;
    transition: color 0.15s, border-color 0.15s;
  }
  .kb-tab:hover { color: var(--text-primary); }
  .kb-tab.active { color: var(--accent-purple); border-bottom-color: var(--accent-purple); }

  /* Keyboard modal keys */
  .kb-row {
    display: flex; gap: 3px; align-items: center;
  }
  .kb-key {
    flex: 1; min-width: 0; height: 30px;
    background: var(--border-raised); color: var(--text-primary); border: 1px solid var(--text-faint);
    border-radius: 4px; font-size: 12px; font-weight: 600; font-family: inherit;
    cursor: pointer; display: flex; align-items: center; justify-content: center;
    box-shadow: 0 2px 0 var(--shadow-key); padding: 0 2px;
    transition: background 0.1s, box-shadow 0.1s, transform 0.05s;
  }
  .kb-key:hover { background: var(--bg-key-hover); border-color: var(--key-hover-border); }
  .kb-key:active { background: var(--bg-key-active); box-shadow: 0 0 0 var(--shadow-key); transform: translateY(2px); }
  .kb-key-remove { color: var(--danger-text); }

  /* Decorative rows */
  .deco-line { flex: 1; height: 1px; background: var(--deco-sep-color); margin: 4px 0; }
  .item-row.is-separator { padding-top: 5px; padding-bottom: 5px; }
  .deco-pagebreak { flex: 1; position: relative; height: 1px; background: var(--accent-violet); margin: 4px 0; opacity: 0.4; }
  .deco-pagebreak span {
    position: absolute; top: -9px; left: 50%; transform: translateX(-50%);
    background: var(--bg-primary); padding: 0 6px; color: var(--accent-violet); font-size: 10px;
  }

  /* Add buttons */
  #add-bar {
    display: flex; align-items: center; justify-content: center;
    padding: 8px; border-top: 1px solid var(--border); gap: 8px;
    position: sticky;
    bottom: 28px;
    background: var(--bg-primary);
    z-index: 50;
  }
  .add-btn {
    background: transparent; border: 1px dashed; border-radius: 6px;
    padding: 4px 12px; font-size: 11px; cursor: pointer; font-weight: 600; opacity: 0.85;
  }
  .add-btn:hover { opacity: 1; }
  .add-btn-mapping  { color: var(--accent-blue);   border-color: var(--accent-blue); }
  .add-btn-category { color: var(--accent-yellow);  border-color: var(--accent-yellow); }
  .add-btn-separator{ color: var(--text-dim);       border-color: var(--text-dim); }
  .add-btn-pagebreak{ color: var(--accent-violet);  border-color: var(--accent-violet); }

  /* ── Context Menu ── */
  #ctx-menu {
    display: none; position: fixed; background: var(--bg-ctx-menu); border: 1px solid var(--border-ui-strong);
    border-radius: 6px; box-shadow: 0 8px 24px rgba(0,0,0,0.4);
    z-index: 2000; padding: 4px 0; min-width: 180px;
  }
  #ctx-menu.show { display: block; }
  #ctx-menu .ctx-item {
    padding: 6px 14px; cursor: pointer; color: var(--text-primary); font-size: 13px;
  }
  #ctx-menu .ctx-item:hover { background: var(--border-ui); }
  #ctx-menu .ctx-item.disabled { color: var(--text-disabled); opacity: 0.5; cursor: default; }
  #ctx-menu .ctx-sep { border-top: 1px solid var(--border-raised); margin: 4px 0; }

  /* ── Modals ── */
  .modal-overlay {
    display: none; position: fixed; inset: 0; background: var(--bg-overlay);
    align-items: center; justify-content: center; z-index: 1000;
  }
  .modal-overlay.show { display: flex; }
  .modal-box {
    background: var(--bg-tertiary); border: 1px solid var(--border-ui-strong); border-radius: 12px;
    padding: 24px; color: var(--text-primary); box-shadow: 0 20px 60px rgba(0,0,0,0.5);
  }
  .modal-title { font-size: 16px; font-weight: 700; margin-bottom: 8px; color: var(--accent-purple); }
  .modal-subtitle { font-size: 12px; color: var(--text-secondary); margin-bottom: 16px; }
  .modal-btn {
    border: none; border-radius: 6px; padding: 8px 16px; font-size: 13px;
    font-weight: 600; cursor: pointer; color: var(--modal-btn-text);
  }
  /* Modal button color variants */
  .modal-btn-cancel     { background: var(--modal-btn-cancel); }
  .modal-btn-neutral    { background: var(--modal-btn-neutral); }
  .modal-btn-skip       { background: var(--modal-btn-skip); }
  .modal-btn-primary    { background: var(--btn-accent); }
  .modal-btn-apply-next { background: var(--modal-btn-apply-next); }
  .modal-btn-export     { background: var(--btn-accent2); }
  .modal-btn-save-meta  { background: var(--modal-btn-save-meta); color: var(--modal-btn-text); }

  /* Modal content areas */
  .modal-item-name {
    font-size: 13px; color: var(--text-highlight);
    background: var(--bg-input); border: 1px solid var(--border-ui); border-radius: 6px;
    padding: 6px 10px; margin-bottom: 12px; font-weight: 600;
    overflow: hidden; text-overflow: ellipsis; white-space: nowrap;
  }
  .modal-item-name-kb {
    font-size: 13px; color: var(--text-highlight);
    background: var(--bg-input); border: 1px solid var(--border-ui); border-radius: 6px;
    padding: 6px 10px; margin-bottom: 8px; font-weight: 600;
    overflow: hidden; text-overflow: ellipsis; white-space: nowrap;
  }
  .modal-current-mapping {
    background: var(--bg-secondary); border: 1px solid var(--border); border-radius: 6px;
    padding: 6px 10px; min-height: 28px;
    display: flex; align-items: center; flex-wrap: wrap; gap: 2px; margin-bottom: 12px;
  }
  .modal-current-mapping-kb {
    background: var(--bg-secondary); border: 1px solid var(--border); border-radius: 6px;
    padding: 6px 10px; min-height: 28px;
    display: flex; align-items: center; flex-wrap: wrap; gap: 2px; margin-bottom: 8px;
  }
  .modal-input-display {
    background: var(--bg-input); border: 1px solid var(--border-ui); border-radius: 8px;
    padding: 16px; min-height: 50px;
    display: flex; align-items: center; justify-content: center; flex-wrap: wrap; gap: 4px;
    margin-bottom: 20px;
  }
  .modal-input-display-kb {
    background: var(--bg-input); border: 1px solid var(--border-ui); border-radius: 8px;
    padding: 10px; min-height: 40px;
    display: flex; align-items: center; justify-content: center; flex-wrap: wrap; gap: 4px;
    margin-bottom: 10px;
  }
  .modal-hint-text {
    font-size: 11px; color: var(--text-dim); margin-bottom: 4px;
  }
  .modal-paddle-hint {
    font-size: 10px; color: var(--text-amber-hint);
    background: var(--bg-paddle-hint); border: 1px solid var(--border-ui); border-radius: 4px;
    padding: 4px 8px; margin-bottom: 8px;
  }
  .modal-paddle-hint code { color: var(--text-subtle); }
  .modal-actions {
    display: flex; gap: 8px; justify-content: flex-end; align-items: center;
  }
  #gamepadButtonGrid { margin-bottom: 14px; }

  /* App.js generated HTML classes */
  .list-empty-msg {
    text-align: center; padding: 40px;
    color: var(--text-muted); font-size: 13px;
  }
  .cat-folder-icon {
    color: var(--accent-yellow); margin-right: 4px; font-size: 12px; flex-shrink: 0;
  }
  .col-name-spacer {
    display: inline-block; width: 16px; margin-right: 2px; flex-shrink: 0;
  }
  /* Gamepad button grid */
  .gp-btn-group-row {
    display: flex; align-items: center; gap: 4px; margin-bottom: 3px;
  }
  .gp-group-label {
    font-size: 9px; color: var(--text-muted);
    min-width: 58px; text-align: right; padding-right: 5px;
    white-space: nowrap; flex-shrink: 0;
  }
  .gp-btn-group-buttons {
    display: flex; gap: 3px; flex-wrap: wrap;
  }
  .gp-btn-sep {
    width: 4px; display: inline-block;
    border-left: 1px solid var(--border-ui);
    height: 20px; align-self: center; margin: 0 1px;
  }
  /* Empty / placeholder states in modals */
  .empty-state-text {
    color: var(--text-muted); font-size: 13px;
  }
  .empty-mapping-hint {
    color: var(--text-muted); font-size: 12px;
  }
  .btn-combo-plus {
    color: var(--text-dim); margin: 0 4px; font-size: 14px;
  }

  /* Export modal controls */
  .export-control {
    background: var(--bg-input); color: var(--text-primary);
    border: 1px solid var(--border-ui-strong); border-radius: 4px; padding: 4px 8px;
  }
  .export-control.number-input { width: 60px; }

  /* ── Status Bar ── */
  #status-bar {
    position: fixed; bottom: 0; left: 0; right: 0;
    background: var(--bg-secondary); border-top: 1px solid var(--border);
    padding: 4px 16px; font-size: 11px; display: flex; align-items: center; gap: 8px;
    color: var(--text-muted); z-index: 100;
  }
  .status-dot {
    width: 8px; height: 8px; border-radius: 50%; display: inline-block;
  }
  .kbd-hint {
    display: inline-block; background: var(--kbd-hint-bg); border: 1px solid var(--kbd-hint-border);
    border-radius: 3px; padding: 0 4px; font-size: 10px; font-family: inherit;
    margin-left: 4px; line-height: 16px; vertical-align: middle; opacity: 0.7;
  }

  /* ── Light Theme ── */
  [data-theme="light"] {
    /* Base palette */
    --bg-primary: #f7f7f8;
    --bg-secondary: #efefef;
    --bg-tertiary: #e8e8ec;
    --bg-input: #ffffff;
    --border: #d0d0d8;
    --text-primary: #1a1a2e;
    --text-secondary: #555570;
    --text-muted: #888899;
    --accent-blue: #2563eb;
    --accent-purple: #7c3aed;
    --accent-yellow: #d97706;
    --accent-green: #059669;
    --accent-violet: #7c3aed;

    /* Text */
    --text-highlight: #0369a1;
    --text-dim: #666680;
    --text-faint: #9999b8;
    --text-subtle: #555568;
    --text-disabled: #aaaaaa;

    /* Borders */
    --border-ui: #c4c4d4;
    --border-ui-strong: #b4b4c8;
    --border-raised: #c0c0d4;
    --border-key: #a0a0b8;

    /* Backgrounds */
    --bg-ctx-menu: #ffffff;
    --bg-paddle-hint: #fffbeb;
    --bg-btn: #e2e2ee;
    --bg-btn-hover: #d2d2e2;
    --bg-key-hover: #c2c2d8;
    --bg-key-active: #b2b2c8;

    /* Shadows */
    --shadow-key: #b0b0c4;

    /* Tree connectors */
    --tree-connector: #9090b8;

    /* Row states */
    --row-hover-bg: rgba(0,0,0,0.04);
    --row-divider: rgba(0,0,0,0.07);
    --row-selected-bg: rgba(37,99,235,0.14);
    --row-drop-bg: rgba(37,99,235,0.22);
    --row-category-bg: rgba(217,119,6,0.08);
    --row-category-hover-bg: rgba(217,119,6,0.15);
    --row-excluded-bg: rgba(251,191,36,0.15); /* ③ ライトテーマの除外行 */

    /* Meta block */
    --meta-bg:          rgba(14,165,233,0.06);
    --meta-hover-bg:    rgba(14,165,233,0.12);
    --meta-border:      rgba(14,165,233,0.35);
    --modal-btn-save-meta: #0284c7;

    /* Misc interactive */
    --collapse-hover-bg: rgba(0,0,0,0.06);
    --btn-badge-border: rgba(0,0,0,0.15);
    --kbd-hint-bg: rgba(0,0,0,0.08);
    --kbd-hint-border: rgba(0,0,0,0.15);

    /* These remain white in light theme too — accent/modal btn backgrounds stay dark */
    --btn-accent-text: #fff;
    --modal-btn-text: #fff;

    /* Overlay scrim — slightly lighter in light theme */
    --bg-overlay: rgba(0,0,0,0.45);
  }

  /* ── Category role badges ── */
  .cat-role-badge {
    display: inline-block;
    font-size: 9px; font-weight: 700;
    padding: 1px 4px; border-radius: 3px;
    margin-right: 5px; flex-shrink: 0;
    font-family: monospace; line-height: 14px;
    vertical-align: middle; opacity: 0.75;
    border: 1px solid var(--border-raised);
    background: var(--bg-ctx-menu);
    cursor: default;
  }
  .cat-role-badge-subcat { color: var(--text-subtle); }
  .cat-role-badge-cat    { color: var(--accent-yellow); }
  .cat-role-badge-hn     { color: var(--accent-blue); }

  /* ── Settings Modal ── */
  .settings-section {
    margin-bottom: 20px;
  }
  .settings-label {
    font-size: 11px;
    font-weight: 600;
    color: var(--text-muted);
    text-transform: uppercase;
    letter-spacing: 0.5px;
    margin-bottom: 8px;
  }
  .segment-control {
    display: flex;
    background: var(--bg-input);
    border: 1px solid var(--border-ui);
    border-radius: 8px;
    padding: 3px;
    gap: 3px;
  }
  .segment-btn {
    flex: 1;
    background: transparent;
    border: none;
    border-radius: 6px;
    padding: 7px 14px;
    font-size: 13px;
    font-weight: 600;
    color: var(--text-secondary);
    cursor: pointer;
    transition: background 0.15s, color 0.15s;
    font-family: inherit;
  }
  .segment-btn:hover {
    color: var(--text-primary);
    background: var(--row-hover-bg);
  }
  .segment-btn.active {
    background: var(--bg-btn);
    color: var(--text-primary);
    box-shadow: 0 1px 3px rgba(0,0,0,0.15);
  }

  /* ── Open Menu Dropdown ────────────────────────────────────────────────── */

  .open-menu-wrap {
    position: relative;
    display: inline-block;
  }

  .open-menu-trigger {
    /* toolbar-btn のスタイルを継承、特別な追加スタイルなし */
  }

  .open-menu-dropdown {
    display: none;
    position: absolute;
    top: calc(100% + 4px);
    left: 0;
    z-index: 1000;
    min-width: 200px;
    background: var(--bg-ctx-menu);
    border: 1px solid var(--border-ui-strong);
    border-radius: 6px;
    box-shadow: 0 6px 20px rgba(0,0,0,0.35);
    padding: 4px 0;
    white-space: nowrap;
  }
  .open-menu-dropdown.show { display: block; }

  .open-menu-item {
    display: block;
    width: 100%;
    text-align: left;
    background: none;
    border: none;
    color: var(--text-primary);
    font-size: 13px;
    padding: 7px 14px;
    cursor: pointer;
    font-family: inherit;
  }
  .open-menu-item:hover {
    background: var(--row-hover-bg);
  }
  .open-menu-item-sample {
    padding-left: 24px;
    color: var(--text-secondary);
    font-size: 12px;
  }
  .open-menu-item-sample:hover {
    color: var(--text-primary);
  }

  .open-menu-sep {
    height: 1px;
    background: var(--border-ui);
    margin: 4px 0;
  }

  .open-menu-section-label {
    font-size: 11px;
    color: var(--text-muted);
    padding: 5px 14px 2px;
    text-transform: uppercase;
    letter-spacing: 0.05em;
  }

  /* ── Gist Dialog / Success Modal ───────────────────────────────────────── */

  .gist-steps {
    margin: 0 0 14px 0;
    padding-left: 22px;
    font-size: 13px;
    color: var(--text-primary);
    line-height: 1.7;
  }
  .gist-steps li { margin-bottom: 2px; }
  .gist-steps a  { color: var(--accent-blue); }

  .gist-url-input {
    width: 100%;
    box-sizing: border-box;
    background: var(--bg-input);
    border: 1px solid var(--border-ui-strong);
    border-radius: 5px;
    color: var(--text-primary);
    font-size: 13px;
    padding: 7px 10px;
    margin-bottom: 6px;
    outline: none;
    font-family: monospace;
  }
  .gist-url-input:focus {
    border-color: var(--border-focus);
  }

  .gist-error {
    font-size: 12px;
    color: var(--danger-text);
    background: var(--danger-bg);
    border-radius: 4px;
    padding: 5px 9px;
    margin-top: 4px;
  }

  .gist-loading {
    font-size: 12px;
    color: var(--text-secondary);
    padding: 4px 0;
  }

  .gist-share-section {
    border-top: 1px solid var(--border-ui);
    padding-top: 12px;
    margin-top: 4px;
  }

  .gist-share-section-title {
    font-size: 12px;
    font-weight: 600;
    color: var(--text-secondary);
    margin-bottom: 6px;
  }

  .gist-success-msg {
    font-size: 13px;
    color: var(--text-primary);
    margin: 0 0 10px 0;
  }

  .gist-share-url-box {
    background: var(--bg-input);
    border: 1px solid var(--border-ui-strong);
    border-radius: 5px;
    padding: 8px 12px;
    word-break: break-all;
  }

  .gist-share-url-text {
    font-family: monospace;
    font-size: 12px;
    color: var(--accent-blue);
    user-select: all;
  }
