  :root {
    --bg-primary: #16161e;
    --bg-secondary: #1a1a2e;
    --bg-tertiary: #1e1e2e;
    --bg-input: #12121f;
    --border: #2a2a3a;
    --border-light: #3a3a4a;
    --text-primary: #e0e0e0;
    --text-secondary: #9a9a9a;
    --text-muted: #717171;
    --accent-blue: #60a5fa;
    --accent-purple: #b0b8ff;
    --accent-yellow: #f59e0b;
    --accent-green: #34d399;
    --accent-violet: #c084fc;
  }
  * { margin: 0; padding: 0; box-sizing: border-box; }
  body {
    font-family: 'Segoe UI', 'メイリオ', sans-serif;
    background: var(--bg-primary); color: var(--text-primary);
    font-size: 13px; line-height: 1.4;
  }
  button { font-family: inherit; }

  /* ── Header ── */
  #header {
    background: var(--bg-secondary); border-bottom: 1px solid var(--border);
    padding: 8px 12px; display: flex; align-items: center; gap: 8px;
    position: sticky; top: 0; z-index: 100; flex-wrap: wrap;
  }
  #header .app-title { font-size: 15px; font-weight: 700; color: var(--accent-purple); margin-right: 4px; }
  #header .github-link {
    color: #888; display: flex; align-items: center;
    text-decoration: none; padding: 2px 4px; border-radius: 4px;
    transition: color 0.15s, background 0.15s;
  }
  #header .github-link:hover { color: #e0e0e0; background: rgba(255,255,255,0.08); }
  #header .filename {
    background: var(--bg-input); border: 1px solid #333; border-radius: 4px;
    padding: 4px 10px; font-size: 12px; color: #78f0c0; font-weight: 600;
  }
  #header .filename[id="filenameDisplay"]:hover {
    border-color: #5a5aff; cursor: pointer;
  }
  #header .filename[id="filenameDisplay"]::after {
    content: " ✏️"; font-size: 10px; opacity: 0; transition: opacity 0.15s;
  }
  #header .filename[id="filenameDisplay"]:hover::after { opacity: 1; }
  .toolbar-spacer { flex: 1; }
  .toolbar-sep { width: 1px; height: 20px; background: #333; }
  .toolbar-btn {
    background: transparent; color: var(--text-primary); border: 1px solid #333;
    border-radius: 6px; padding: 5px 12px; font-size: 12px; font-weight: 600;
    cursor: pointer; display: flex; align-items: center; gap: 4px; white-space: nowrap;
  }
  .toolbar-btn:hover { background: #2a2a3a; }
  .toolbar-btn:disabled { opacity: 0.4; cursor: default; }
  .toolbar-btn.accent { background: #2563eb; border: none; }
  .toolbar-btn.accent:hover { background: #1d4ed8; }
  a.toolbar-btn { text-decoration: none; }
  a.toolbar-btn:visited { color: var(--text-primary); }
  .toolbar-btn.accent2 { background: #7c3aed; border: none; }
  .toolbar-btn.accent2:hover { background: #6d28d9; }

  /* ── Column Headers ── */
  #col-headers {
    display: flex; align-items: center; padding: 4px 8px;
    background: #1a1a28; border-bottom: 1px solid var(--border);
    font-size: 10px; color: #888; font-weight: 600; text-transform: uppercase;
    letter-spacing: 0.5px; position: sticky; top: 44px; z-index: 99;
  }
  #col-headers .col-type { width: 80px; flex-shrink: 0; margin-right: 6px; padding-left: 8px; }
  #col-headers .col-name { flex: 1; }
  #col-headers .col-mapping { width: 280px; flex-shrink: 0; }
  #col-headers .col-output { width: 32px; flex-shrink: 0; text-align: center; }

  /* ── Item Rows ── */
  #item-list { padding: 2px 0; padding-bottom: 88px; }
  .item-row {
    display: flex; align-items: center; padding: 3px 8px;
    border-left: 2px solid transparent; border-bottom: 1px solid rgba(255,255,255,0.03);
    transition: background 0.1s; cursor: default;
  }
  .item-row:hover { background: rgba(255,255,255,0.03); }
  .item-row.selected { background: rgba(96,165,250,0.12); border-left-color: var(--accent-blue); }
  .drag-handle {
    width: 18px; flex-shrink: 0; cursor: grab; color: #555;
    font-size: 14px; text-align: center; user-select: none;
    line-height: 24px; margin-right: 2px; border-radius: 3px;
  }
  .drag-handle:hover { color: #aaa; background: rgba(255,255,255,0.06); }
  .drag-handle:active { cursor: grabbing; }
  .row-delete-btn {
    width: 22px; height: 22px; flex-shrink: 0; margin-left: 4px;
    background: transparent; border: none; border-radius: 4px;
    color: #555; font-size: 15px; line-height: 20px; cursor: pointer;
    display: flex; align-items: center; justify-content: center;
    opacity: 0; transition: opacity 0.15s, color 0.15s, background 0.15s;
  }
  .item-row:hover .row-delete-btn { opacity: 1; }
  .row-delete-btn:hover { color: #f87171; background: rgba(248,113,113,0.12); }
  .item-row.drop-child {
    background: rgba(96,165,250,0.15) !important;
    outline: 1px dashed #60a5fa;
    outline-offset: -1px;
  }
  .item-row .col-type { width: 80px; flex-shrink: 0; margin-right: 6px; }
  .item-row .col-name { flex: 1; min-width: 0; margin-right: 8px; display: flex; align-items: center; }
  .item-row .col-mapping { width: 280px; flex-shrink: 0; display: flex; align-items: center; gap: 4px; }
  .item-row .col-output { width: 32px; flex-shrink: 0; text-align: center; }

  /* Output toggle */
  .output-toggle {
    background: transparent; border: 1px solid #555; cursor: pointer;
    width: 24px; height: 24px; border-radius: 4px;
    display: inline-flex; align-items: center; justify-content: center;
    font-size: 14px; line-height: 1; padding: 0;
    color: #4ade80;
    transition: all 0.15s;
  }
  .output-toggle:hover { border-color: #888; background: rgba(255,255,255,0.06); }
  .output-toggle.excluded {
    color: #555; border-color: #333;
  }
  .output-toggle.excluded:hover { border-color: #666; }
  .output-toggle.inherited-exclude {
    color: #444; border-color: #2a2a2a; cursor: default;
  }

  .type-select {
    background: transparent; color: var(--accent-blue); border: 1px solid var(--border-light);
    border-radius: 4px; padding: 2px 4px; font-size: 11px; font-weight: 600;
    cursor: pointer; outline: none; width: 100%;
  }
  .type-select option { background: #252536; }

  .name-input {
    background: transparent; color: var(--text-primary); border: none; outline: none;
    flex: 1; min-width: 0; font-size: 12px; padding: 2px 4px;
    border-bottom: 1px solid transparent;
  }
  .name-input:focus { border-bottom: 1px solid #5a5aff; }
  .name-input.is-category { color: var(--accent-yellow); font-size: 13px; font-weight: 700; }

  .collapse-toggle {
    display: inline-flex; align-items: center; justify-content: center;
    width: 16px; flex-shrink: 0; text-align: center; cursor: pointer;
    color: #999; font-size: 10px; margin-right: 2px; user-select: none;
    border-radius: 3px; line-height: 18px; vertical-align: middle;
    transition: color 0.15s;
  }
  .collapse-toggle:hover { color: #ddd; background: rgba(255,255,255,0.08); }

  /* Tree connectors */
  .tree-guide {
    display: inline-flex; flex-shrink: 0; width: 20px;
    position: relative; align-self: stretch;
  }
  .tree-guide-line {
    position: absolute; left: 9px; top: 0; bottom: 0;
    border-left: 1px solid #8888bb;
  }
  .tree-guide-branch {
    position: absolute; left: 9px; top: 0; height: 50%;
    border-left: 1px solid #8888bb;
    border-bottom: 1px solid #8888bb;
    width: 8px; border-bottom-left-radius: 4px;
  }
  .tree-guide-last .tree-guide-branch {
    height: 50%;
  }

  /* (parent-select removed — use drag-and-drop for re-parenting) */

  /* Mapping display */
  .mapping-box {
    flex: 1; background: var(--bg-input); border-radius: 4px; border: 1px solid var(--border);
    min-height: 28px; display: flex; align-items: center; padding: 2px 4px;
    cursor: text; min-width: 0; overflow: hidden;
  }
  .mapping-box.empty { color: var(--text-muted); font-size: 11px; font-style: italic; }
  .mapping-edit-input {
    background: var(--bg-input); color: var(--text-primary); border: 1px solid #5a5aff;
    border-radius: 4px; padding: 2px 6px; font-size: 12px; font-family: monospace;
    width: 100%; outline: none;
  }
  .gamepad-btn {
    background: #2a2a3a; border: 1px solid var(--border-light); border-radius: 4px;
    width: 28px; height: 28px; display: flex; align-items: center; justify-content: center;
    cursor: pointer; flex-shrink: 0; font-size: 14px; padding: 0; color: #aaa;
    transition: background 0.15s, border-color 0.15s;
  }
  .gamepad-btn:hover { background: #3a3a5a; border-color: #6a6aff; }

  /* Button badges */
  .btn-badge {
    display: inline-flex; align-items: center; justify-content: center;
    padding: 1px 5px; border-radius: 4px; font-size: 11px; font-weight: 700;
    margin-right: 1px; min-width: 20px; line-height: 18px; font-family: monospace;
    box-shadow: 0 1px 2px rgba(0,0,0,0.3); border: 1px solid rgba(255,255,255,0.15);
  }
  .btn-plus { color: #888; margin: 0 2px; font-size: 10px; }
  .key-badge {
    display: inline-flex; align-items: center; justify-content: center;
    padding: 1px 5px; border-radius: 3px; font-size: 10px; font-weight: 700;
    margin-right: 1px; min-width: 20px; line-height: 18px; font-family: monospace;
    background: #3a3a4a; color: #e0e0e0; border: 1px solid #666;
    box-shadow: 0 2px 0 #222, 0 1px 2px rgba(0,0,0,0.3);
  }
  .mapping-text {
    color: #bbb; font-size: 11px; line-height: 18px; margin: 0 1px; white-space: pre;
  }

  /* Keyboard modal tabs */
  .kb-tabs {
    display: flex; gap: 2px; margin-bottom: 8px;
    border-bottom: 1px solid var(--border-light);
  }
  .kb-tab {
    background: transparent; border: none; border-bottom: 2px solid transparent;
    color: var(--text-secondary); font-size: 12px; font-weight: 600;
    padding: 4px 14px; cursor: pointer; margin-bottom: -1px;
    transition: color 0.15s, border-color 0.15s;
  }
  .kb-tab:hover { color: var(--text-primary); }
  .kb-tab.active { color: var(--accent-purple); border-bottom-color: var(--accent-purple); }

  /* Keyboard modal keys */
  .kb-row {
    display: flex; gap: 3px; align-items: center;
  }
  .kb-key {
    flex: 1; min-width: 0; height: 30px;
    background: #3a3a4a; color: #e0e0e0; border: 1px solid #555;
    border-radius: 4px; font-size: 12px; font-weight: 600; font-family: inherit;
    cursor: pointer; display: flex; align-items: center; justify-content: center;
    box-shadow: 0 2px 0 #222; padding: 0 2px;
    transition: background 0.1s, box-shadow 0.1s, transform 0.05s;
  }
  .kb-key:hover { background: #4a4a6a; border-color: #7a7aff; }
  .kb-key:active { background: #5a5a8a; box-shadow: 0 0 0 #222; transform: translateY(2px); }

  /* Decorative rows */
  .deco-line { flex: 1; height: 1px; background: #666; margin: 4px 0; }
  .item-row.is-separator { padding-top: 5px; padding-bottom: 5px; }
  .deco-pagebreak span {
    position: absolute; top: -9px; left: 50%; transform: translateX(-50%);
    background: var(--bg-primary); padding: 0 6px; color: var(--accent-violet); font-size: 10px;
  }

  /* Add buttons */
  #add-bar {
    display: flex; align-items: center; justify-content: center;
    padding: 8px; border-top: 1px solid var(--border); gap: 8px;
    position: sticky;
    bottom: 28px;
    background: var(--bg-primary);
    z-index: 50;
  }
  .add-btn {
    background: transparent; border: 1px dashed; border-radius: 6px;
    padding: 4px 12px; font-size: 11px; cursor: pointer; font-weight: 600; opacity: 0.85;
  }
  .add-btn:hover { opacity: 1; }

  /* ── Context Menu ── */
  #ctx-menu {
    display: none; position: fixed; background: #252536; border: 1px solid #444;
    border-radius: 6px; box-shadow: 0 8px 24px rgba(0,0,0,0.4);
    z-index: 2000; padding: 4px 0; min-width: 180px;
  }
  #ctx-menu.show { display: block; }
  #ctx-menu .ctx-item {
    padding: 6px 14px; cursor: pointer; color: #ddd; font-size: 13px;
  }
  #ctx-menu .ctx-item:hover { background: #333; }
  #ctx-menu .ctx-item.disabled { color: #666; opacity: 0.5; cursor: default; }
  #ctx-menu .ctx-sep { border-top: 1px solid #3a3a4a; margin: 4px 0; }

  /* ── Modals ── */
  .modal-overlay {
    display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.6);
    align-items: center; justify-content: center; z-index: 1000;
  }
  .modal-overlay.show { display: flex; }
  .modal-box {
    background: var(--bg-tertiary); border: 1px solid #444; border-radius: 12px;
    padding: 24px; color: var(--text-primary); box-shadow: 0 20px 60px rgba(0,0,0,0.5);
  }
  .modal-title { font-size: 16px; font-weight: 700; margin-bottom: 8px; color: var(--accent-purple); }
  .modal-subtitle { font-size: 12px; color: var(--text-secondary); margin-bottom: 16px; }
  .modal-btn {
    border: none; border-radius: 6px; padding: 8px 16px; font-size: 13px;
    font-weight: 600; cursor: pointer; color: #fff;
  }

  /* ── Status Bar ── */
  #status-bar {
    position: fixed; bottom: 0; left: 0; right: 0;
    background: var(--bg-secondary); border-top: 1px solid var(--border);
    padding: 4px 16px; font-size: 11px; display: flex; align-items: center; gap: 8px;
    color: var(--text-muted); z-index: 100;
  }
  .status-dot {
    width: 8px; height: 8px; border-radius: 50%; display: inline-block;
  }
  .kbd-hint {
    display: inline-block; background: rgba(255,255,255,0.12); border: 1px solid rgba(255,255,255,0.2);
    border-radius: 3px; padding: 0 4px; font-size: 10px; font-family: inherit;
    margin-left: 4px; line-height: 16px; vertical-align: middle; opacity: 0.7;
  }
